# Last Hand - 游戏设计文档 (Game Design Document)

**版本**: 0.2  
**类型**: Pixel-art Survival Roguelike Deckbuilder  
**核心机制**: 修改版 Blackjack (21点) 战斗系统

---

## 1. 游戏概述 (Game Overview)

### 1.1 核心定位
"Last Hand" 是一款基于 21 点规则的回合制生存 Roguelike 游戏。玩家在一个反乌托邦/赛博朋克风格的数字世界中，通过卡牌博弈与系统守护进程（敌人）进行战斗。

### 1.2 核心体验
*   **博弈感**: 在“抽牌（Hit）”与“停牌（Stand）”之间权衡风险。
*   **资源管理**: 管理 HP（生命值）、护盾以及消耗品道具。
*   **生存压力**: 牌库资源有限（单局共享牌库），伤害随点数差值计算，失败代价高昂。
*   **视觉风格**: 独特的“手部动作”Avatar 系统，配合像素艺术、Glitch（故障）特效和冲击感极强的动画。

---

## 2. 基础规则与独有改动 (Rules & Modifications)

### 2.1 牌库构成 (The Deck)
与传统 Blackjack 不同，本游戏使用一副极度精简的 **共享微型牌库**。
*   **总卡牌数**: 11 张。
*   **卡牌构成**: 数字 1 到 10 各一张，Ace 一张。
    *   **无花色影响**: 虽然视觉上有花色，但在逻辑上仅计算点数。
    *   **移除牌**: 无 J, Q, K。
*   **共享机制**: 玩家与敌人从同一副牌堆中抽牌。这意味着算牌（Card Counting）是核心策略——如果你手里有大牌，敌人抽到大牌的几率就会降低。

### 2.2 点数计算
*   **数字牌 (1-10)**: 点数等于牌面数字。
*   **Ace (A)**: 默认为 11 点。如果总分超过目标分数（通常为 21），则自动降为 1 点。
*   **目标分数**: 21 点。

### 2.3 胜负判定
*   **Bust (爆牌)**: 超过 21 点即为爆牌。
*   **胜利**: 未爆牌且点数高于对手；或对手爆牌而自己未爆。
*   **平局**: 双方点数相同；或双方同时爆牌。

---

## 3. 游戏流程与回合机制 (Game Flow & Turn Mechanics)

游戏处于一个无限的 **Run (轮回)** 结构中，包含多个 **Level (关卡)**，每个关卡包含多个 **Round (回合)**。

### 3.1 战斗流程 (Battle Phase)

1.  **发牌阶段 (Dealing)**:
    *   系统洗牌（11张）。
    *   按顺序发牌：玩家 -> 敌人 -> 玩家 -> 敌人。
    *   玩家 2 张牌均为明牌。
    *   敌人 1 张明牌，1 张暗牌。
    *   *注：若双方均持有满额道具，会跳过道具发放，否则随机补充直至上限。*

2.  **行动阶段 (Action Phase)**:
    *   **轮流行动制**: 玩家与敌人交替行动。通常由玩家先手。
    *   **玩家行动选项**:
        *   **HIT (拿牌)**: 从剩余牌库抽一张牌。若牌库空，则无法抽牌。行动后，若未爆牌，控制权交给敌人（除非敌人已 Stand）。
        *   **STAND (停牌)**: 锁定当前手牌，不再抽牌。一旦 Stand，该回合内无法再进行任何行动。控制权永久交给敌人，直到回合结束。
        *   **USE ITEM (使用物品)**: 使用库存中的道具。不消耗回合数（即使用后仍可继续 Hit 或 Stand）。
    *   **敌人行动选项**:
        *   由 AI 逻辑决定 Hit 或 Stand。

3.  **结算阶段 (Resolution - The Clash)**:
    *   触发条件：双方均选择 **STAND**。
    *   **揭示**: 敌人暗牌翻开。
    *   **Clash 动画**: 双方分数在屏幕中央碰撞，判定胜负。
    *   **伤害结算**: 根据胜负扣除 HP。
    *   **清理**: 丢弃手牌，若双方存活，进入下一 Round。

### 3.2 关卡与奖励 (Level & Reward)
*   **胜利条件**: 敌人 HP 归零。
*   **失败条件**: 玩家 HP 归零（Game Over）。
*   **战利品 (Loot)**: 击败敌人后进入奖励界面，从 3 个随机道具中选择加入库存。
*   **升级**: 进入下一关，敌人难度提升（HP 增加）。

---

## 4. 实体与数值系统 (Entities & Stats)

### 4.1 玩家 (Player)
*   **HP**: 初始 10 点。归零即死。
*   **Shield (护盾)**: 抵挡伤害。护盾在回合间保留，不会自动消失。
*   **Inventory (库存)**: 最多持有 3 个道具。
*   **Hand (手牌)**: 当前持有的卡牌。

### 4.2 敌人 (Enemy)
敌人拥有与玩家相同的属性结构，但具有不同的 AI 行为。

#### 伤害公式 (Damage Formula)
伤害计算是不对称的：

1.  **玩家受到伤害**:
    *   若玩家 **Bust (爆牌)**: 固定受到 **4** 点伤害。
    *   若玩家输给敌人 (Enemy Score > Player Score): 伤害 = **(敌人分数 - 玩家分数)**。
    *   *例: 敌人 20 vs 玩家 17 -> 玩家受到 3 点伤害。*
    *   **护盾抵扣**: 优先消耗护盾，剩余溢出部分扣除 HP。

2.  **敌人受到伤害**:
    *   若玩家胜利 (Player Wins): 敌人固定受到 **2** 点伤害。
    *   *设计意图: 玩家生存压力大，需要规避高额爆发伤害；而敌人依靠血量优势（Roguelike 常见设计）消耗玩家。*

3.  **特殊情况**:
    *   双方同时 Bust: 视为平局，或者双方受到轻微惩罚（视觉上表现为 Hurt，但逻辑上通常判定为平局不扣血，或特定规则下双输）。当前逻辑为：双方 Hurt 动画，无 HP 扣除（Draw）。

---

## 5. AI 系统 (Enemy AI)

敌人根据其 `aiType` 决定行动逻辑。

### 5.1 Greedy Ghost (贪婪型)
*   **逻辑**: 只要分数 < 18，就强制 Hit。
*   **描述**: 极具攻击性，容易爆牌，但也容易打出高分。

### 5.2 Defensive Daemon / Firewall (防御型)
*   **逻辑**: 分数 >= 16 即 Stand。
*   **描述**: 保守策略，等待玩家爆牌。

### 5.3 Script Kiddie / Random (随机型)
*   **逻辑**:
    *   分数 >= 21 (或接近目标): Stand。
    *   分数 < 目标 - 6 (如 < 15): Hit。
    *   中间区域 (15-20): 50% 概率随机 Hit 或 Stand。

---

## 6. 物品系统 (Item System)

物品分为 **消耗品 (Consumable)**，使用一次后消失。

| ID | 名称 (Name) | 效果 (Effect) | 备注 |
| :--- | :--- | :--- | :--- |
| `potion_small` | **Glitch Salve** | 恢复 3 点 HP (不超过上限) | 生存核心 |
| `shield_temp` | **Firewall** | 获得 5 点 Shield | 应对高分差回合 |
| `reload` | **Cache Clear** | 强制抽一张牌 | 特殊逻辑：若牌库空，会将弃牌堆重洗后抽牌。打破牌库限制。 |
| `peek_deck` | **Packet Sniffer**| 偷看牌库顶的下一张牌 | 信息博弈，决定是否 Hit 的关键 |

---

## 7. UI 与视觉反馈 (UI & Visuals)

### 7.1 布局
*   **顶部**: 敌人区域（手牌呈扇形展开，HP 条，状态徽章）。
*   **中部**: 信息提示区（Jitter Text 抖动文字）。
*   **底部**: 玩家区域（手牌，操作按钮 HIT/STAND，HP 条）。
*   **左侧/右侧**: 统计数据（关卡层数）、牌库剩余量查看器、物品图鉴入口。
*   **角落**: 玩家物品栏（左下），敌人物品栏（右上，仅显示背面）。

### 7.2 手部 Avatar 系统 (Hand Avatars)
这是游戏标志性的视觉特征。屏幕角落有 pixel-art 风格的手部。
*   **Idle**: 随呼吸轻微浮动。
*   **Hit**: 手部伸出屏幕，做出抓牌动作。
*   **Stand**: 手部做出“停止/拍桌”手势。
*   **Use Item**: 手部做出抛掷或激活物品的动作。
*   **Hurt**: 手部剧烈颤抖，颜色通过滤镜变红/故障化。

### 7.3 关键动画
*   **Deal Animation**: 卡牌从屏幕外飞入，带有旋转和缩放。
*   **Clash Overlay**: 结算时，背景变暗，双方分数巨大化并在屏幕中央对撞。
*   **Damage Numbers**: 伤害数字带有“故障(Glitch)”特效，从实体身上飘出。
*   **Score Intensity**: 玩家分数显示框会根据分数高低改变颜色和发光强度（接近 21 点时呈现金/紫色脉冲）。
*   **Item Activation**: 使用物品时，物品卡片放大至屏幕中央，伴随光效和全屏文字（SYSTEM UPGRADE / MALWARE DETECTED）。

---

## 8. 技术实现备注 (Technical Notes)

*   **状态管理**: 既然是 React 应用，`GameState` 包含了所有核心数据（牌库、实体、阶段）。
*   **动画实现**: 使用 CSS Keyframes (Tailwind) 处理大部分过渡动画。`sleep()` 函数用于在异步流程中控制动画播放节奏（如发牌停顿）。
*   **响应式**: 适配桌面与移动端布局（通过 `sm:` 断点调整卡牌大小和位置）。
*   **牌库逻辑**: 必须严格维护 `deck` 数组。抽牌是 `pop()` 操作。使用了 `Fisher-Yates` 洗牌算法。

---

## 9. 未来扩展规划 (Roadmap)
*   **更多物品**: 增加直接对敌人造成伤害、强制敌人弃牌、交换手牌等道具。
*   **新敌人**: 增加会使用道具的敌人、拥有特殊被动（如每回合自动回复护盾）的 Boss。
*   **无尽模式**: 增加 Run 的长度，引入 Meta-progression（局外成长）。
